# ツールパス座標計算アプリ v2 要件定義書

## 概要

金属加工現場で使用するツールパス座標計算アプリ。
数学的な知識がなくても、**ビジュアルファースト**のアプローチで直感的に操作できることを目指す。

---

## 設計思想

### Before（現行）
```
数値入力 → 図形表示 → 結果
（数学的アプローチ）
```

### After（改良版）
```
パターン選択 → 向き選択 → 数値調整 → 結果
（イメージ先行アプローチ）
```

### 基本方針
- **数学感をなくす**: 三角関数や座標系の知識がなくても使える
- **イメージ先行**: まずカードで「やりたいこと」を選ぶ
- **必要最小限の入力**: 限られた情報だけを吸い上げる
- **ツールパス特化**: 図面座標ではなく、進入・退出を加味した加工用座標

---

## 用語定義

| 用語 | 説明 |
|------|------|
| ツールパス | 工具が移動する経路 |
| 進入（アプローチ） | 加工開始点に向かう工具の移動 |
| 退出（リトラクト） | 加工終了後に工具が離れる移動 |
| 進入距離 | 加工ラインの手前から進入を開始する距離（mm） |
| 面取り角度 | 水平線から測った面取りの角度（度） |
| 基準点 | 座標計算の基準となる点（角の頂点など） |

---

## 機能要件

### Phase 1: 外角面取り - 進入点計算

#### ユースケース
ワークの外角を面取り加工する際の、工具進入開始点の座標を求める。

```
                    ● ← 進入開始点（これを求める）
                   ╱
                  ╱ 進入距離
                 ╱
                ● ← 面取り開始点（基準点として入力）
               ╱
              ╱ 面取り角度
─────────────┘
```

#### 画面フロー

```
[ホーム画面]
    │
    ▼ カード選択
[シナリオ選択画面]
    │
    ▼ 「外角面取り」を選択
[向き選択画面]
    │
    ▼ 4方向から選択
[パラメータ入力画面]
    │
    ▼ 計算実行
[結果表示画面]
```

#### シナリオ選択画面

カード形式で加工パターンを表示：

| カード | 説明 |
|--------|------|
| 外角面取り | ワーク外側の角を面取り |
| （将来）内角面取り | ワーク内側の角を面取り |
| （将来）円弧進入 | 円弧に接線方向から進入 |
| （将来）その他 | ... |

#### 向き選択画面

4方向の角の向きをビジュアルで選択：

```
┌────────────┬────────────┐
│    ┌───    │    ───┐    │
│    │       │       │    │
│   左上      │     右上    │
├────────────┼────────────┤
│    │       │       │    │
│    └───    │    ───┘    │
│   左下      │     右下    │
└────────────┴────────────┘
```

選択した向きに応じて、内部で計算時の符号・角度オフセットを自動処理。

#### パラメータ入力画面

```
┌─────────────────────────────────┐
│                                 │
│  [選択した向きのイラスト表示]      │
│                                 │
├─────────────────────────────────┤
│                                 │
│  ■ 角の座標（基準点）             │
│    X: [________]  Y: [________] │
│                                 │
│  ■ 面取り角度                    │
│    [30°] [45°] [60°] [自由入力]  │
│    └─ プリセットボタン             │
│                                 │
│  ■ 進入距離                      │
│    [  2  ] mm   ← デフォルト: 2mm │
│                                 │
│           [ 計算 ]               │
│                                 │
└─────────────────────────────────┘
```

##### 入力項目

| 項目 | 必須 | デフォルト | 説明 |
|------|------|-----------|------|
| 角の座標 X | ○ | - | 基準点のX座標（mm） |
| 角の座標 Y | ○ | - | 基準点のY座標（mm） |
| 面取り角度 | ○ | 45° | プリセット: 30°, 45°, 60° または自由入力 |
| 進入距離 | ○ | 2mm | アプローチ距離 |

#### 結果表示画面

```
┌─────────────────────────────────┐
│                                 │
│  [計算結果を図で表示]             │
│   - 基準点                       │
│   - 面取りライン                  │
│   - 進入開始点（ハイライト）       │
│                                 │
├─────────────────────────────────┤
│                                 │
│  ■ 進入開始点                    │
│    X: 48.27   Y: -58.27         │
│                                 │
│  [コピー] [履歴に保存]            │
│                                 │
└─────────────────────────────────┘
```

##### 出力項目

| 項目 | 説明 |
|------|------|
| 進入開始点 X | 工具が進入を開始するX座標 |
| 進入開始点 Y | 工具が進入を開始するY座標 |

---

## 計算ロジック

### 外角面取り - 進入点計算

#### 入力
- 基準点: P(x, y)
- 面取り角度: θ（水平線から測定、度）
- 進入距離: d（mm）

#### 向き別の計算

| 向き | 面取り方向ベクトル | 進入点座標 |
|------|------------------|-----------|
| 右上 | (cos(180°-θ), sin(180°-θ)) | P + d × 方向ベクトル |
| 左上 | (cos(θ), sin(θ)) | P + d × 方向ベクトル |
| 右下 | (cos(180°+θ), sin(180°+θ)) | P + d × 方向ベクトル |
| 左下 | (cos(-θ), sin(-θ)) | P + d × 方向ベクトル |

※実装時に符号・角度の詳細を調整

---

## 非機能要件

### UI/UX
- タッチフレンドリー（最小タップ領域: 48dp）
- 現場での視認性を考慮した大きめのテキスト
- 数学的な用語を避けた分かりやすいラベル
- 日本語UI

### 設定
- 小数点桁数: 1〜3桁（デフォルト: 2桁）
- 進入距離デフォルト: 2mm

### データ
- 計算履歴の保存・削除
- 設定の永続化

---

## 将来の拡張（Phase 2以降）

| 機能 | 説明 |
|------|------|
| 内角面取り | 内側の角の面取り進入点計算 |
| 円弧進入 | 円弧に接線方向から進入する点の計算 |
| 退出点計算 | 加工終了後の退出点計算 |
| 複数ステップ | 進入 → 加工 → 退出 の一連の座標セット |

---

## 画面遷移図

```
┌─────────────┐
│   ホーム     │
│ (シナリオ選択) │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   向き選択   │
│  (4方向)    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ パラメータ入力 │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   結果表示   │
└──────┬──────┘
       │
       ├──→ [履歴に保存]
       │
       └──→ [新しい計算] → ホームへ戻る
```

---

## 既存機能との関係

| 既存機能 | 対応 |
|---------|------|
| 直線×直線の交点計算 | 将来的に「交点計算」シナリオとして統合可能 |
| 直線×円の交点計算 | 同上 |
| 円×円の交点計算 | 同上 |
| 履歴管理 | 継続利用 |
| 設定（小数点桁数） | 継続利用 |

---

## 更新履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2026-01-10 | 1.0 | 初版作成 |
